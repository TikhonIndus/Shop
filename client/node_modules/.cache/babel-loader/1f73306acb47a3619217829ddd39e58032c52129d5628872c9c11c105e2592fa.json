{"ast":null,"code":"var _jsxFileName = \"F:\\\\shop\\\\client\\\\src\\\\pages\\\\Shop.js\",\n  _s = $RefreshSig$();\nimport { Container, Row, Col, Spinner } from 'react-bootstrap';\nimport CategoryBar from '../components/CategoryBar.js';\nimport BrandBar from '../components/BrandBar.js';\nimport ProductList from '../components/ProductList.js';\nimport { useContext, useEffect, useState } from 'react';\nimport { AppContext } from '../components/AppContext.js';\nimport { fetchCategories, fetchBrands, fetchAllProducts } from '../http/catalogAPI.js';\nimport { observer } from 'mobx-react-lite';\nimport { useLocation, useSearchParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst getSearchParams = searchParams => {\n  let category = searchParams.get('category');\n  if (category && /[1-9][0-9]*/.test(category)) {\n    category = parseInt(category);\n  }\n  let brand = searchParams.get('brand');\n  if (brand && /[1-9][0-9]*/.test(brand)) {\n    brand = parseInt(brand);\n  }\n  let page = searchParams.get('page');\n  if (page && /[1-9][0-9]*/.test(page)) {\n    page = parseInt(page);\n  }\n  return {\n    category,\n    brand,\n    page\n  };\n};\nconst Shop = _s(observer(_c = _s(() => {\n  _s();\n  const {\n    catalog\n  } = useContext(AppContext);\n  const [categoriesFetching, setCategoriesFetching] = useState(true);\n  const [brandsFetching, setBrandsFetching] = useState(true);\n  const [productsFetching, setProductsFetching] = useState(true);\n  const location = useLocation();\n  const [searchParams] = useSearchParams();\n  useEffect(() => {\n    fetchCategories().then(data => catalog.categories = data).finally(() => setCategoriesFetching(false));\n    fetchBrands().then(data => catalog.brands = data).finally(() => setBrandsFetching(false));\n    const {\n      category,\n      brand,\n      page\n    } = getSearchParams(searchParams);\n    catalog.category = category;\n    catalog.brand = brand;\n    catalog.page = page !== null && page !== void 0 ? page : 1;\n    fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit).then(data => {\n      catalog.products = data.rows;\n      catalog.count = data.count;\n    }).finally(() => setProductsFetching(false));\n    // eslint-disable-next-line\n  }, []);\n  useEffect(() => {\n    const {\n      category,\n      brand,\n      page\n    } = getSearchParams(searchParams);\n    if (category || brand || page) {\n      if (category !== catalog.category) catalog.category = category;\n      if (brand !== catalog.brand) catalog.brand = brand;\n      if (page !== catalog.page) catalog.page = page !== null && page !== void 0 ? page : 1;\n    } else {\n      catalog.category = null;\n      catalog.brand = null;\n      catalog.page = 1;\n    }\n    // eslint-disable-next-line\n  }, [location.search]);\n  useEffect(() => {\n    setProductsFetching(true);\n    setTimeout(() => {\n      fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit).then(data => {\n        catalog.products = data.rows;\n        catalog.count = data.count;\n      }).finally(() => setProductsFetching(false));\n    }, 1000);\n    // eslint-disable-next-line\n  }, [catalog.category, catalog.brand, catalog.page]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: /*#__PURE__*/_jsxDEV(Row, {\n      className: \"mt-2\",\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        md: 3,\n        className: \"mb-3\",\n        children: categoriesFetching ? /*#__PURE__*/_jsxDEV(Spinner, {\n          animation: \"border\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(CategoryBar, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        md: 9,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: brandsFetching ? /*#__PURE__*/_jsxDEV(Spinner, {\n            animation: \"border\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(BrandBar, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: productsFetching ? /*#__PURE__*/_jsxDEV(Spinner, {\n            animation: \"border\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(ProductList, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 9\n  }, this);\n}, \"7Tdec6KNjt19Pkpp3ErjDRpOQeQ=\", false, function () {\n  return [useLocation, useSearchParams];\n})), \"7Tdec6KNjt19Pkpp3ErjDRpOQeQ=\", false, function () {\n  return [useLocation, useSearchParams];\n});\n_c2 = Shop;\nexport default Shop;\nvar _c, _c2;\n$RefreshReg$(_c, \"Shop$observer\");\n$RefreshReg$(_c2, \"Shop\");","map":{"version":3,"names":["Container","Row","Col","Spinner","CategoryBar","BrandBar","ProductList","useContext","useEffect","useState","AppContext","fetchCategories","fetchBrands","fetchAllProducts","observer","useLocation","useSearchParams","jsxDEV","_jsxDEV","getSearchParams","searchParams","category","get","test","parseInt","brand","page","Shop","_s","_c","catalog","categoriesFetching","setCategoriesFetching","brandsFetching","setBrandsFetching","productsFetching","setProductsFetching","location","then","data","categories","finally","brands","limit","products","rows","count","search","setTimeout","children","className","md","animation","fileName","_jsxFileName","lineNumber","columnNumber","_c2","$RefreshReg$"],"sources":["F:/shop/client/src/pages/Shop.js"],"sourcesContent":["import { Container, Row, Col, Spinner } from 'react-bootstrap'\r\nimport CategoryBar from '../components/CategoryBar.js'\r\nimport BrandBar from '../components/BrandBar.js'\r\nimport ProductList from '../components/ProductList.js'\r\nimport { useContext, useEffect, useState } from 'react'\r\nimport { AppContext } from '../components/AppContext.js'\r\nimport { fetchCategories, fetchBrands, fetchAllProducts } from '../http/catalogAPI.js'\r\nimport { observer } from 'mobx-react-lite'\r\nimport { useLocation, useSearchParams } from 'react-router-dom'\r\n\r\nconst getSearchParams = (searchParams) => {\r\n    let category = searchParams.get('category')\r\n    if (category && /[1-9][0-9]*/.test(category)) {\r\n        category = parseInt(category)\r\n    }\r\n    let brand = searchParams.get('brand')\r\n    if (brand && /[1-9][0-9]*/.test(brand)) {\r\n        brand = parseInt(brand)\r\n    }\r\n    let page = searchParams.get('page')\r\n    if (page && /[1-9][0-9]*/.test(page)) {\r\n        page = parseInt(page)\r\n    }\r\n    return {category, brand, page}\r\n}\r\n\r\nconst Shop = observer(() => {\r\n    const { catalog } = useContext(AppContext)\r\n\r\n    const [categoriesFetching, setCategoriesFetching] = useState(true)\r\n    const [brandsFetching, setBrandsFetching] = useState(true)\r\n    const [productsFetching, setProductsFetching] = useState(true)\r\n\r\n    const location = useLocation()\r\n    const [searchParams] = useSearchParams()\r\n\r\n    useEffect(() => {\r\n        fetchCategories()\r\n            .then(data => catalog.categories = data)\r\n            .finally(() => setCategoriesFetching(false))\r\n\r\n        fetchBrands()\r\n            .then(data => catalog.brands = data)\r\n            .finally(() => setBrandsFetching(false))\r\n\r\n        const {category, brand, page} = getSearchParams(searchParams)\r\n        catalog.category = category\r\n        catalog.brand = brand\r\n        catalog.page = page ?? 1\r\n\r\n        fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit)\r\n            .then(data => {\r\n                catalog.products = data.rows\r\n                catalog.count = data.count\r\n            })\r\n            .finally(() => setProductsFetching(false))\r\n        // eslint-disable-next-line\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const {category, brand, page} = getSearchParams(searchParams)\r\n\r\n        if (category || brand || page) {\r\n            if (category !== catalog.category) catalog.category = category\r\n            if (brand !== catalog.brand) catalog.brand = brand\r\n            if (page !== catalog.page) catalog.page = page ?? 1\r\n        } else  {\r\n            catalog.category = null\r\n            catalog.brand = null\r\n            catalog.page = 1\r\n        }\r\n        // eslint-disable-next-line\r\n    }, [location.search])\r\n\r\n    useEffect(() => {\r\n        setProductsFetching(true)\r\n        setTimeout(() => {\r\n            fetchAllProducts(catalog.category, catalog.brand, catalog.page, catalog.limit)\r\n                .then(data => {\r\n                    catalog.products = data.rows\r\n                    catalog.count = data.count\r\n                })\r\n                .finally(() => setProductsFetching(false))\r\n        }, 1000)\r\n        // eslint-disable-next-line\r\n    }, [catalog.category, catalog.brand, catalog.page])\r\n\r\n    return (\r\n        <Container>\r\n            <Row className=\"mt-2\">\r\n                <Col md={3} className=\"mb-3\">\r\n                    {categoriesFetching ? (\r\n                        <Spinner animation=\"border\" />\r\n                    ) : (\r\n                        <CategoryBar />\r\n                    )}\r\n                </Col>\r\n                <Col md={9}>\r\n                    <div>\r\n                        {brandsFetching ? (\r\n                            <Spinner animation=\"border\" />\r\n                        ) : (\r\n                            <BrandBar />\r\n                        )}\r\n                    </div>\r\n                    <div>\r\n                        {productsFetching ? (\r\n                            <Spinner animation=\"border\" />\r\n                        ) : (\r\n                            <ProductList />\r\n                        )}\r\n                    </div>\r\n                </Col>\r\n            </Row>\r\n        </Container>\r\n    )\r\n})\r\n\r\nexport default Shop"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}